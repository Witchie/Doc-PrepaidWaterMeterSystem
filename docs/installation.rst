============
安装
============

客户端安装
-----------

许可证工具使用
~~~~~~~~~~~~~~~

解压许可证授权工具后，你将得到如下文件

.. figure:: img/keytool1.png

找到''**激活码生成工具.exe**'' 打开，将弹出如下界面

.. figure:: img/keytool2.png

参数介绍

.. list-table::

    * - 参数名称
      - 作用
      - 备注
    * - PID
      - 客户代码，错误的PID可能导致卡片无法解密，系统会使用PID加密卡片，不同的客户对应不同的PID
      - 表厂给水司分配的ID，不同水司不可互读
    * - 客户名称
      - 水司名称
      - 水司的公司名称    
    * - 客户编号
      - 给水司的编号
      - 无实际意义
    * - 注册日期
      - 动态库启用时间
      - 在这个日期前动态库将不可使用
    * - 结束日期
      - 动态库停用时间
      - 在这个事件之后动态库将被禁用
    * - 开发时间
      - 阀门开启的时间
      - 无实际意义
    * - 关阀时间
      - 阀门关闭的时间
      - 无实际意义

配置完成后

将此许可证发给水司使用即可。

.. note::
    - 一家自来水公司使用一个许可证文件即可，对于同一个自来水公司只要保证PID值唯一即可。
    - 错误的PID可能导致卡片无法解密。更会导致卡片报废。 

软件配置
~~~~~~~~~~~~~~~

数据库安装
------------

联网版 SQl Server数据库
~~~~~~~~~~~~~~~

单机版 SQLCE数据库
~~~~~~~~~~~~~~~

数据库迁移
------------

该功能是将第一代的预付费水表管理系统升级为第二代。整体迁移思路活动图如下

    .. figure:: img/brain1.png

一代单机版升级二代
~~~~~~~~~~~~~~~
"**Access数据库解密步骤**"

    打开数据库工具界面如下

    .. figure:: img/dbtool6.png
    
    导数据之前必须先配置目标数据库，如下图并指定要目标数据库类型，目前支持的数据库类型有SQLCE（单机数据库）、SQL Server 。单击生效

    .. figure:: img/dbtool7.png

    .. note::
    - MYSQL已在新版中删除

    指定好数据库类型后根据对应的数据库配置好对应的 “服务器连接地址”、“数据库文件名称”、“数据库登陆账户”、“数据库登陆密码”,然后单击“连接”并“保存”，最后单击“初始化数据库”,数据库迁移前必须先初始化目标数据库，并保证在迁移数据库启动一次预付费系统（系统会加载卡片类型，写入本地数据库）。

    数据库初始化完成后，请单击“数据库迁移”按钮，接下来进行数据库迁移工作

    .. note::
      - 迁移前请仔细阅读注意事项
    
    .. figure:: img/dbtool8.png

    单击“下一步”，开始解密，单击“打开”，加载Access源数据库文件，单号单击解密，数据库文件便会被解密（如果是网络版数据库，请直接跳过此步骤）

    .. figure:: img/dbtool9.png

    
一代网络版升级二代
~~~~~~~~~~~~~~~


二代单机版升级二代网络版
~~~~~~~~~~~~~~~

.. note::
    - 该迁移功能只针对SqlCe单机版数据库可使用


详细操作

    打开数据库工具

    首先选择SqlServer数据库，填写数据库连接字符串，连接->保存->数据库初始化 
    
    .. figure:: img/dbtool1.png

    初始化完成后，选择SqlCe数据库
    
    .. figure:: img/dbtool2.png

    点击【数据库单机转网络】按钮

    填写上步完成初始化的数据库连接字符串，连接并且保存，点击下一步 

    .. figure:: img/dbtool3.png     

    .. figure:: img/dbtool4.png

    这里逐表进行数据迁移。先读取再写入

    .. figure:: img/dbtool5.png

    第七步无问题操作完成后,将数据库工具的数据库类型改成SQLServer。因为在迁移的时候，我们是以SqlCe来迁移的。

    重新打开预付费水表管理系统。重新分配权限，即可查看到数据已经迁移完成.

.. note::

    如果某一步骤由于网络原因出错，请直接重试该步骤即可，迁移为差异复制，相同数据不会重复复制