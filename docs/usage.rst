========
客户端使用方法
========

系统设置
-----------

装载许可证文件
~~~~~~~~~~~~~~~

权限设置
~~~~~~~~~~~~~~~

1.角色权限分配前需要系统中先存在对应的登陆角色角色设置,只有有了对应的角色才能有权限。
2.当系统中存在一个及一个以上登陆角色时设置角色权限才有意义。

.. figure:: img/right.png

.. note::
    - 请不要修改系统管理员的权限，这样可以避免因为误操作而导致权限管理界面不可用。
    - 当系统新增功能后需要手动为登陆角色分配权限。此操作会影响所有为当前登录角色的登录用户

新增的角色类型的权限默认为空。如果未分配权限，用户登入系统后界面将是一片空白。

.. figure:: img/right2.png

当权限被勾选后左侧 导航列表才会有其对应菜单。

.. figure:: img/right3.png


..  note::
     - 注意：一些二级权限勾选后会在所在界面内部显示


角色设置
~~~~~~~~~~~~~~~

角色设置，也就是登录用户的类型，预付费水表管理系统根据用户类型的不同，会设置不同的使用权限，不同的权限，相应用户的用户登录后界面也会有所差异。

.. figure:: img/role.png

..  note::
      - 登录角色一旦创建后将不可删除，仅支持修改登录角色名称。

添加登陆类型
^^^^^^^^^^^^^^^

添加登陆类型时登陆类别和登陆名称建议使用同一名称。

.. note::

    - 不同版本的系统UI界面可能会有所不同
    
.. figure:: img/role1.png


账户管理
~~~~~~~~~~~~~~~

用户管理便是对实际登陆系统的用户的管理。

包含:新增账号、编辑账号、删除账号、重置密码

账号管理之前，请确保您已包含至少一个登陆角色。角色设置

账号登陆后一片空白，或者不存在想要的菜单，请先配置权限权限设置

新增账号
^^^^^^^^^^^^^^^

登陆账号：用户在登陆界面提供的账号。

登陆昵称：用户的名称或者昵称。（打印票据、发票时会调用）

账号类型：为用户分配的登录角色。角色设置

.. note::

    - 新增的登陆账号密码"12345678"
 
编辑账号
^^^^^^^^^^^^^^^

编辑账号请右键选择对应的账号单击右键即可。

当账户类型错误时可通过修改账户类型修改。


删除账号
^^^^^^^^^^^^^^^

不建议删除账号。删除账号可能导致某些数据丢失会查询不到。

此功能仅建议在初期测试时使用。


重置密码
^^^^^^^^^^^^^^^

重置密码后，登录密码将被重置为"12345678"

系统参数设置
-----------

系统参数设置
~~~~~~~~~~~~~~~

系统参数设置可配的信息有 串口的端口名称，水表的类型（旧卡小口径水表或新卡大小口径水表）

.. note::
    - 不同的水表类型 将会出现不同的界面，请务必确认水表类型正确。
    - 如果选择错了水表类型 则会导致卡片不可读写

打印组件配置

我们支持的打印方式有

    * 不打印
    * 默认打印方式
    * 重庆市的打印方式
    * 增强型发票打印方式

在使用前 请记得配置好您要使用的打印方式。


驱动下载
~~~~~~~~~~~~~~~

由于系统使用了Silicon Labs CP210x USB to UART Bridge 读卡器。所以在使用前我们需要先为客户端安装好对应的读卡器驱动。

读卡器支持列表

  * Windows Xp
  * Windows 7
  * Windows 8/8.1
  * Windows 10

我们已在软件中内嵌了 Xp、Win7和Win10的

.. figure:: img/driver.png

如果这些还不足以满足您的电脑,您可以去官网下载最新的驱动。

下载地址:https://cn.silabs.com/developers/usb-to-uart-bridge-vcp-drivers

..  note::
      - 由于silabs 官网可能频繁变动，我们无法保证此链接永久可用

基础数据
--------

客户类型管理
~~~~~~~~~~~~~~~

根据卡片类型的不同，对应的价格参数也是不同的，针对不同类型的用户指定的收费策略也是不同的。详细信息请看阶梯水价

..  note::
     - 客户类型编辑之前请先加载系统版本读写卡模块

**具体说明**
  
  假设 额定用量1为44m³，额定用量2为75m³；一级单价1.2元;二级单价1.5元;三级单价2.0元时;

+--------+--------+
|用量    |单价    |
+========+========+
|20      |1.2     |
+--------+--------+
|30      |1.2     |
+--------+--------+
|40      |1.2     |
+--------+--------+
|50      |1.5     |
+--------+--------+
|60      |1.5     |
+--------+--------+
|70      |1.5     |
+--------+--------+
|80      |2.0     |
+--------+--------+
|90      |2.0     |
+--------+--------+
|100     |2.0     |
+--------+--------+

对应的设置结果如下图

.. figure:: img/stepprice1.png

则其对用的阶梯价梯图为

.. figure:: img/stepprice2.png

当用户用水量为30m³时，则实际需缴纳费用为30*1.2=3.6元;

当用户用水量为120m³时，则实际需缴纳费用为

44*1.2+70*1.5+10*2.0=45.2+105+20=170.2元

..  note::
      - 三级单价>二级单价>一级单价;其中，一级单价=排污费+水资源管理费+单价增量
      - 用户发卡时收取的费用为开户费用，而不是卡片费用，用户补卡时收取的费用为卡片费用

小区信息管理
~~~~~~~~~~~~~~~

小区是添加表具用户的必备条件，没有对应的小区信息是不能添加用户的。

+-------------+-----------------------------------------------+
|名称         |描述                                           |
+=============+===============================================+
|小区编号     |建议使用数值增量添加                           |
+-------------+-----------------------------------------------+
|小区名称     |显示出来的小区名称。开具发票时会调用此信息     |
+-------------+-----------------------------------------------+
|详细地址     |小区的详细地址，最好精确到街道级别             |
+-------------+-----------------------------------------------+
|状态信息     |无关项                                         |
+-------------+-----------------------------------------------+

.. figure:: img/area.png
 

状态信息不用管。


制作特权卡
~~~~~~~~~~~~~~~

制作设置卡
^^^^^^^^^^^^^^^

制作时间卡
^^^^^^^^^^^^^^^

制作基表卡
^^^^^^^^^^^^^^^

制作修正卡
^^^^^^^^^^^^^^^

制作检测卡
^^^^^^^^^^^^^^^

制作恢复卡
^^^^^^^^^^^^^^^

制作管理卡
^^^^^^^^^^^^^^^

制作换表卡
^^^^^^^^^^^^^^^

卡片清除
^^^^^^^^^^^^^^^

卡片读取
^^^^^^^^^^^^^^^




业务操作
--------

卡片操作
~~~~~~~~~~~~~~~

消费记录
~~~~~~~~~~~~~~~

卡片补水
~~~~~~~~~~~~~~~

黑名单
~~~~~~~~~~~~~~~

物业费
~~~~~~~~~~~~~~~

用户资料
~~~~~~~~~~~~~~~

用户资料管理
^^^^^^^^^^^^^^^

导入导出用户数据
^^^^^^^^^^^^^^^

换表补卡
^^^^^^^^^^^^^^^

补卡
^^^^^^^^^^^^^^^

发卡
^^^^^^^^^^^^^^^

报表管理
--------

收费统计日报表
~~~~~~~~~~~~~~~

收费统计月报表
~~~~~~~~~~~~~~~

收费统计年报表
~~~~~~~~~~~~~~~

物业费查询
~~~~~~~~~~~~~~~

营业统计
~~~~~~~~~~~~~~~

超级报表
~~~~~~~~~~~~~~~

超级报表1
~~~~~~~~~~~~~~~




其他
--------

报表设计器
~~~~~~~~~~~~~~~

编写中...

  小伙子别急..


修改密码
~~~~~~~~~~~~~~~

新建的账号默认密码为

  12345678 

如要修改，请单击 **修改密码** 按钮

.. figure:: img/modify.png

..  note::
    - 修改后的密码长度至少需要6个字符

.. figure:: img/modify1.png

密码修改完成后系统将跳转到登录界面。



阶梯水价
~~~~~~~~~~~~~~~

  **阶梯水价** 是对使用自来水实行分类计量收费和超定额累进加价制的俗称。**阶梯水价** 充分发挥市场、价格因素在水资源配置、水需求调节等方面的作用，拓展了水价上调的空间，增强了企业和居民的节水意识，避免了水资源的浪费。阶梯式计量水价将水价分为两段或者多段，每一分段都有一个保持不变的单位水价，但是单位水价会随着耗水量分段而增加。

  **阶梯水价** 的基本特点是用水越多，水价越贵。例如有的城市将居民的生活用水水价设定两个水量的分界点，从而形成三种收费标准：用水15吨以内为人民币0．6元∕吨，15—20吨为1．4元∕吨，20吨以上为2．1元∕吨。缺水城市可实行高额累进加价制。

  早在2002年4月1日，中国国务院国家计委、财政部、建设部、水利部、国家环保总局就联合发出《关于进一步推进城市供水价格改革工作的通知》，要求进一步推进城市供水价格改革。《通知》要求全国各省辖市以上城市须在2003年底前实行阶梯水价，其他城市则在2005年底之前实行阶梯水价。

  2014年1月3日，国家发展改革委、住房城乡建设部出台“指导意见”，要求2015年底前，所有设市城市原则上全面实行居民阶梯水价制度。

表端错误提示
~~~~~~~~~~~~~~~

本系统中如果在卡操作过程出现错误,液晶会提示错误,LED 闪烁报警。

.. figure:: img/error.png

**错误表**

+-------+-------------+-------------------------------------------+
|#      |错误显示     |错误原因                                   |
+=======+=============+===========================================+
|1      |Error_01     |校验和出错                                 |
+-------+-------------+-------------------------------------------+
|2      |Error_03     |二级低压，不能进行卡操作                   |
+-------+-------------+-------------------------------------------+
|3      |Error_04     |未开户或未刷测试卡                         |
+-------+-------------+-------------------------------------------+
|4      |Error_05     |用户卡表号不对应                           |
+-------+-------------+-------------------------------------------+
|5      |Error_06     |提前拔卡                                   |
+-------+-------------+-------------------------------------------+
|6      |Error_07     |超出最大购买量                             |
+-------+-------------+-------------------------------------------+
|7      |Error_12     |刷卡过快或者不是本客户系统卡               |
+-------+-------------+-------------------------------------------+
|8      |Error_15     |卡片确认失败，线圈未连接好或有磁场干扰     |
+-------+-------------+-------------------------------------------+
|9      |Error_16     |阶梯价设置错误，不能为0                    |
+-------+-------------+-------------------------------------------+
|10     |Error_17     |换表卡二次换出时表号不对应                 |
+-------+-------------+-------------------------------------------+
|11     |Error_18     |充值不成功表端充值次数大于卡次数           |
+-------+-------------+-------------------------------------------+



